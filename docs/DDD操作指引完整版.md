# DDD（领域驱动设计）操作指引完整版

**作者：** 伍志勇  
**创建时间：** 2025年9月22日  
**文档版本：** v0.6  
**最后更新：** 2025年9月22日  

---

## 📋 概述

本文档提供了一套完整的DDD（领域驱动设计）操作流程指引，包含明确的步骤、详细的checklist、参与岗位建议以及时间估算，帮助团队系统化地实施DDD方法论。

---

## 🎯 DDD操作流程总览表

| 阶段 | 步骤 | 核心任务 | 参与岗位 | 时间估算 | 关键Checklist | 成功标准 | 输出物 |
|-----|------|----------|----------|----------|---------------|----------|---------|
| **阶段一：深度业务理解** | 1.1 客户痛点深度挖掘 | 业务专家深度访谈、现有系统痛点分析、业务流程瓶颈识别、隐性需求挖掘 | 🎯 业务架构师（主导）<br>👥 领域专家<br>📊 产品经理 | 3-5天 | ☐ 完成至少5个关键业务人员访谈<br>☐ 识别出现有系统3个以上主要痛点<br>☐ 梳理出业务流程中的瓶颈环节<br>☐ 挖掘出客户未明确表达的隐性需求 | 获得客户痛点清单并得到业务方确认 | 《客户痛点分析报告》 |
| | 1.2 事件风暴工作坊 | 领域事件识别、业务规则发现、领域概念统一、业务边界划分 | 🎯 业务架构师（主导）<br>👥 领域专家<br>🏗️ DDD架构师<br>📊 产品经理 | 2-3天 | ☐ 识别出所有关键领域事件（≥20个）<br>☐ 发现并记录业务规则和约束<br>☐ 建立统一的业务术语词典（≥50个术语）<br>☐ 初步划分业务边界和上下文 | 产出完整的领域事件图谱和统一语言词典 | 《事件风暴工作坊成果》<br>《统一语言词典》 |
| | 1.3 商业价值评估 | 解决方案ROI分析、市场机会评估、竞争优势分析、风险评估与规避 | 🎯 业务架构师（主导）<br>📊 产品经理<br>🏗️ DDD架构师 | 2天 | ☐ 完成项目投资回报率计算<br>☐ 评估市场潜力和竞争态势<br>☐ 识别3个以上差异化价值点<br>☐ 制定风险应对策略 | ROI≥150%，获得管理层投资批准 | 《商业价值评估报告》 |
| | 1.4 通用语言建立 | 业务术语统一、概念模型构建、沟通效率提升、知识传承保障 | 🎯 业务架构师（主导）<br>👥 领域专家<br>🏗️ DDD架构师 | 1-2天 | ☐ 建立完整的业务术语表<br>☐ 创建核心概念的可视化模型<br>☐ 制定团队沟通规范<br>☐ 建立知识传承机制 | 团队成员能准确使用统一语言进行沟通 | 《通用语言规范文档》 |
| **阶段二：领域战略设计** | 2.1 核心领域识别 | 确定业务核心价值领域、评估领域优先级、定义领域边界 | 🏗️ DDD架构师（主导）<br>🎯 业务架构师<br>👥 领域专家 | 2-3天 | ☐ 识别出1-3个核心领域<br>☐ 评估各领域的业务价值和复杂度<br>☐ 明确各领域边界和依赖关系<br>☐ 制定领域优先级排序 | 核心领域得到业务和技术团队一致认可 | 《核心领域识别报告》<br>《领域优先级矩阵》 |
| | 2.2 限界上下文划分 | 定义清晰的业务边界、确定上下文映射关系、识别上下文集成点 | 🏗️ DDD架构师（主导）<br>🎯 业务架构师<br>💻 开发团队负责人 | 3-4天 | ☐ 划分出3-8个限界上下文<br>☐ 定义每个上下文的职责和边界<br>☐ 确定上下文间的映射关系<br>☐ 识别集成点和防腐层需求 | 限界上下文划分通过技术评审 | 《限界上下文设计文档》<br>《上下文映射图》 |
| | 2.3 聚合根设计 | 设计聚合根实体、定义实体和值对象、建立不变约束 | 🏗️ DDD架构师（主导）<br>💻 开发团队负责人<br>✅ 质量保障工程师 | 4-5天 | ☐ 为每个聚合设计根实体<br>☐ 定义实体和值对象及其关系<br>☐ 建立业务不变约束规则<br>☐ 设计聚合间的引用关系 | 聚合设计满足高内聚低耦合原则 | 《聚合根设计文档》<br>《实体关系图》 |
| | 2.4 领域服务定义 | 抽象复杂业务逻辑、定义服务接口、规划服务实现策略 | 🏗️ DDD架构师（主导）<br>💻 开发团队负责人<br>✅ 质量保障工程师 | 2-3天 | ☐ 识别需要抽象为服务的复杂逻辑<br>☐ 定义清晰的领域服务接口<br>☐ 制定服务实现的技术策略<br>☐ 规划服务测试方案 | 领域服务接口设计通过评审 | 《领域服务接口规范》 |
| **阶段三：战术设计与实现** | 3.1 技术架构选型 | 选择合适的技术栈、设计系统架构、制定部署方案 | 🏗️ DDD架构师（主导）<br>💻 开发团队负责人<br>✅ 质量保障工程师 | 3-4天 | ☐ 评估3种以上技术方案<br>☐ 选择适合的技术栈和框架<br>☐ 设计高可用、可扩展的架构<br>☐ 制定详细的部署方案 | 架构方案通过CTO或技术委员会评审 | 《技术架构选型报告》<br>《系统架构图》 |
| | 3.2 分层架构实现 | 实现领域层核心逻辑、应用服务编排、基础设施适配 | 💻 开发团队负责人（主导）<br>🏗️ DDD架构师（指导）<br>👥 开发团队成员 | 2-3周 | ☐ 按照分层架构实现代码<br>☐ 确保领域层纯净无技术依赖<br>☐ 应用服务正确编排业务逻辑<br>☐ 基础设施层适配各种外部依赖 | 代码结构清晰，符合分层原则 | 《分层架构实现代码》 |
| | 3.3 领域事件建模 | 定义领域事件规范、设计事件流、实现事件处理逻辑 | 🏗️ DDD架构师（主导）<br>💻 开发团队负责人<br>📊 产品经理 | 3-4天 | ☐ 定义标准化的领域事件格式<br>☐ 设计完整的事件流图谱<br>☐ 实现事件发布和订阅机制<br>☐ 建立事件溯源机制 | 事件模型支持业务流程自动化 | 《领域事件规范》<br>《事件流图》 |
| | 3.4 代码实现与测试 | 编写领域模型代码、实现单元测试、集成测试、性能测试 | 💻 开发团队负责人（主导）<br>✅ 质量保障工程师<br>👥 开发团队成员 | 2-3周 | ☐ 代码实现符合设计规范<br>☐ 单元测试覆盖率≥80%<br>☐ 集成测试覆盖核心业务流程<br>☐ 性能测试满足性能要求 | 代码通过CI/CD流水线，测试覆盖率达标 | 《代码实现文档》<br>《测试报告》 |
| **阶段四：验证与迭代优化** | 4.1 用户验收测试 | 制定UAT测试用例、执行验收测试、收集用户反馈、缺陷跟踪修复 | ✅ 质量保障工程师（主导）<br>👥 领域专家<br>📊 产品经理 | 1-2周 | ☐ 制定完整的UAT测试用例<br>☐ 执行所有验收测试场景<br>☐ 收集并整理用户反馈<br>☐ 跟踪并修复发现的缺陷 | UAT通过率≥95%，关键业务场景验证通过 | 《UAT测试报告》<br>《用户反馈汇总》 |
| | 4.2 系统性能优化 | 性能瓶颈分析、系统调优、架构优化、监控完善 | 🏗️ DDD架构师（主导）<br>💻 开发团队负责人<br>✅ 质量保障工程师 | 持续进行 | ☐ 识别并解决性能瓶颈<br>☐ 优化系统响应时间<br>☐ 完善监控告警机制<br>☐ 建立性能基线标准 | 系统性能提升≥20%，稳定性达到99.9% | 《性能优化报告》 |
| | 4.3 领域模型演进 | 收集演进需求、分析变更影响、制定迁移计划、保证向后兼容 | 🏗️ DDD架构师（主导）<br>🎯 业务架构师<br>👥 领域专家 | 按需进行 | ☐ 收集业务模型变更需求<br>☐ 分析模型变更的技术影响<br>☐ 制定版本迁移计划<br>☐ 设计向后兼容方案 | 模型演进方案获得业务和技术团队批准 | 《领域模型演进方案》 |
| | 4.4 持续改进机制 | 建立反馈收集机制、定期回顾优化、制定迭代计划、价值度量 | 📊 产品经理（主导）<br>👥 领域专家<br>🎯 业务架构师 | 持续进行 | ☐ 建立用户反馈收集渠道<br>☐ 定期组织回顾会议<br>☐ 制定持续优化计划<br>☐ 建立价值度量体系 | 建立持续改进机制，每月发布优化版本 | 《持续改进计划》<br>《价值度量报告》 |

---

## 👥 岗位角色详细说明

### 核心岗位角色

| 岗位角色 | 主要职责 | 关键技能要求 | 在DDD中的定位 |
|---------|----------|-------------|---------------|
| 🎯 业务架构师 | 负责商业模式分析、业务能力建模、价值流分析 | 业务分析、流程建模、商业思维 | 连接业务与技术的桥梁 |
| 🏗️ DDD架构师 | 负责领域建模、架构设计、技术选型 | DDD理论、架构设计、技术领导力 | DDD实施的技术主导者 |
| 👥 领域专家 | 提供业务知识、验证模型准确性、参与事件风暴 | 深度业务知识、行业经验 | 业务知识的权威来源 |
| 📊 产品经理 | 负责需求管理、产品规划、用户价值验证 | 产品思维、用户研究、数据分析 | 用户价值的守护者 |
| 💻 开发团队负责人 | 负责代码实现、技术落地、团队协调 | 编程技能、团队管理、技术决策 | 技术实现的执行者 |
| ✅ 质量保障工程师 | 负责测试策略、质量保证、缺陷管理 | 测试技能、质量意识、分析能力 | 质量的守门人 |

---

## 📊 实施建议与最佳实践

### 成功实施的关键要素

#### 1. 组织准备
- **获得高层支持**：确保管理层理解并支持DDD实施
- **组建跨职能团队**：建立包含业务、技术、测试的完整团队
- **制定实施路线图**：明确各阶段目标和时间节点
- **投入必要资源**：保证人员、时间、预算的充足投入

#### 2. 能力建设
- **开展DDD培训**：为团队成员提供系统的DDD理论培训
- **建立实践社区**：创建DDD实践分享和交流机制
- **培养核心骨干**：重点培养DDD架构师和业务架构师
- **引入外部专家**：必要时引入DDD实施经验丰富的外部专家

#### 3. 工具支持
- **建模工具**：选择合适的领域建模工具（如EventStorming工具）
- **开发工具**：配置支持DDD分层的开发环境和框架
- **协作平台**：建立高效的团队协作和知识共享平台
- **监控系统**：构建完善的系统监控和性能分析工具

#### 4. 过程管理
- **建立评审机制**：设置关键里程碑的评审检查点
- **实施风险管控**：识别并制定风险应对策略
- **保持敏捷迭代**：采用小步快跑的方式逐步推进
- **持续总结改进**：定期回顾总结实施经验和教训

### 常见陷阱与规避策略

| 常见陷阱 | 表现形式 | 规避策略 |
|---------|----------|----------|
| 过度设计 | 模型过于复杂，增加不必要的抽象 | 坚持简单原则，只解决实际问题 |
| 业务理解偏差 | 技术人员对业务理解不准确 | 加强业务专家参与，多轮验证确认 |
| 团队技能不足 | 团队缺乏DDD实施经验 | 加强培训，引入外部专家指导 |
| 忽视边界划分 | 上下文边界不清晰，耦合严重 | 重视边界划分，采用防腐层保护 |
| 缺乏持续演进 | 模型一成不变，无法适应业务变化 | 建立模型演进机制，定期回顾优化 |

### 事件风暴工作坊详细实践指南

#### 工作坊核心概念与工件

事件风暴使用不同颜色的即时贴代表不同的业务概念，建立统一的视觉语言：

| 工件类型 | 颜色 | 描述与核心价值 | 提问引导 | 实际案例 |
|---------|------|---------------|----------|----------|
| **领域事件** | 橙色 | 代表业务流程中已经发生的、对领域有价值的事实。必须使用过去时态动词。是整个模型的基石。 | "系统运行后，发生了什么有意义的事情？" | 订单已创建、库存已锁定、支付已成功 |
| **命令** | 蓝色 | 代表用户或系统意图发起的操作，是导致领域事件发生的原因 | "是什么动作导致了这个事件的发生？" | 创建订单、锁定库存、支付订单 |
| **执行者** | 黄色(小) | 代表发起命令的人或系统 | "是谁或什么发起了这个命令？" | 买家、客服、支付网关、定时任务 |
| **聚合** | 黄色(大) | DDD的核心，业务操作的一致性边界 | "哪个业务对象负责处理这个命令？" | 订单、库存、账户 |
| **策略/反应** | 紫色 | 代表自动化业务逻辑，当X事件发生时自动执行Y命令 | "当这个事件发生后，系统需要自动触发什么？" | 当订单已创建时，自动发起锁定库存 |
| **读模型** | 绿色 | 用户为了做出决策需要看到的信息界面 | "用户在执行这个命令前，需要看到什么信息？" | 商品详情页、订单列表、库存仪表盘 |
| **外部系统** | 粉色 | 与系统交互的第三方系统或遗留系统 | "这个操作是和哪个外部系统交互的？" | 支付网关、物流系统、ERP系统 |
| **热点/问题** | 红色 | 代表讨论中不确定、有争议或需要澄清的问题 | "这里我们不确定，先记下来。" | 退款规则是什么？状态谁来维护？ |

#### 工作坊准备阶段

**1. 明确目标与范围**
- 确定本次事件风暴的具体目标：探索新业务还是优化现有流程？
- 设定清晰的讨论边界，防止讨论无限发散
- 制定预期产出和成功标准

**2. 邀请"对的人"**
必须邀请所有相关利益方，特别是掌握真实业务规则的一线领域专家：
- 领域专家（业务员、客服、运营等）
- 产品经理/业务分析师
- 架构师和开发工程师
- 测试工程师
- **经验丰富的引导者**：负责控制节奏、引导讨论、确保规则遵守

**3. 准备物料**
- 足够大的连续墙面或白板（"无限"建模空间）
- 各种颜色的高质量即时贴（确保粘性足够）
- 粗头记号笔（每人一支）
- 计时器和闹钟
- 相机或手机（记录成果）

#### 工作坊执行流程（7步法）

**第一步：混沌探索 - 领域事件**
- **动作**：所有参与者用橙色便签写下业务流程中会发生的所有领域事件
- **规则**：不限顺序，不讨论，先追求数量；必须使用"过去时态"
- **目的**：大脑风暴和知识倾倒，快速显性化所有人的隐性知识
- **时间控制**：15-20分钟

**第二步：强制时间线**
- **动作**：将所有事件按从左到右的时间顺序排列
- **规则**：如有顺序争议，用红色热点便签标记，不深入讨论
- **目的**：构建业务流程的叙事性，形成清晰的业务故事线
- **技巧**：可以分组进行，然后合并结果

**第三步：识别命令与执行者**
- **动作**：针对每个领域事件，反向提问：
  - "是什么动作导致了这个事件？" → 蓝色命令便签
  - "是谁或什么发起了这个命令？" → 黄色执行者便签
- **贴法**：执行者 → 命令 → 事件（左到右的顺序）
- **目的**：明确系统交互点和用户意图

**第四步：定义聚合**
- **动作**：寻找业务规则和数据一致性的边界
- **方法**：将同一个业务实体负责的命令和事件用黄色大便签圈起来
- **目的**：识别DDD的核心，为限界上下文和微服务边界奠定基础
- **示例**：所有与订单状态流转相关的命令和事件圈在"订单"聚合内

**第五步：引入策略**
- **动作**：寻找"当A事件发生后，系统自动触发B命令"的业务规则
- **表示**：用紫色便签表示，用箭头连接事件和命令
- **目的**：发现自动化流程和跨聚合交互，为事件驱动架构提供输入

**第六步：添加读模型**
- **动作**：针对每个执行者和命令，提问：
  - "用户在做这个操作前，需要看到什么信息才能决策？"
- **表示**：绿色便签代表所需的信息界面
- **目的**：识别查询需求，为CQRS架构和UI设计提供输入

**第七步：识别限界上下文**
- **动作**："退后一步"从宏观观察，寻找自然边界
- **识别信号**：
  - **语言转变**：同一概念在不同区域有不同名称
  - **物理边界**：如财务系统和物流系统的交互
  - **模型密度**：聚合和事件高度聚集的区域
- **表示**：用记号笔在墙上画出边界线
- **目的**：产生事件风暴的最终产出——微服务拆分的候选边界

#### 不同层级的事件风暴应用

**战略级事件风暴（Big Picture）**
- **目标**：探索整个业务版图，识别核心业务领域和子域
- **参与者**：高层管理者、产品战略家、核心架构师
- **主要工件**：领域事件、外部系统、热点
- **产出**：宏观限界上下文划分

**流程级事件风暴（Process Modeling）**
- **目标**：聚焦具体跨部门业务流程（如"从下单到收款"）
- **参与者**：流程负责人、产品经理、相关团队代表
- **主要工件**：事件、命令、策略、读模型
- **产出**：详细流程模型和优化建议

**设计级事件风暴（Software Design）**
- **目标**：针对已划定限界上下文内部进行详细软件设计
- **参与者**：上下文内的架构师、开发、测试团队
- **主要工件**：所有工件，特别关注聚合边界
- **产出**：可直接指导代码实现的详细设计

#### 工作坊成功关键要素

**引导者的重要作用**
- 提出正确的问题，而非提供答案
- 控制讨论节奏，确保流程遵守
- 保证每个人都有发言机会
- 及时处理冲突和争议

**避免常见陷阱**
1. **邀请错误的人**：没有真正领域专家的参与
2. **过早陷入细节**：在发散阶段就开始深入讨论
3. **模型CRUD化**：充满"X已创建"、"X已更新"等无业务价值事件
4. **忽视语言统一**：不同人对同一概念理解不一致
5. **缺乏后续行动**：工作坊成果没有转化为实际开发

**最佳实践建议**
- **物理空间**：选择安静、宽敞、有自然光的空间
- **时间控制**：单次工作坊不超过4小时，可安排多轮
- **能量维持**：准备零食饮料，安排适当休息
- **成果固化**：及时拍照记录，后续整理成电子文档
- **跟进机制**：建立明确的后续行动计划和责任人

### 实际案例：电商订单处理事件风暴

**业务背景**：某电商平台需要重新设计订单处理系统，涉及多个业务部门和外部系统。

**工作坊参与人员**：
- 业务专家：订单处理专员、客服主管、财务专员
- 技术团队：架构师、开发负责人、测试负责人
- 产品团队：产品经理、业务分析师
- 引导者：资深DDD架构师

**关键发现**：
1. **语言差异**：仓储部门称之为"出库单"，物流部门称之为"运单"
2. **隐藏规则**：VIP客户的订单有特殊的处理流程
3. **系统交互**：发现与第三方支付系统的交互存在时序问题
4. **业务边界**：明确了订单中心、库存中心、财务中心的职责边界

**最终产出**：
- 识别出3个限界上下文：订单上下文、库存上下文、财务上下文
- 发现15个关键领域事件和12个自动化策略
- 优化了订单处理流程，预计提升处理效率30%
- 为微服务拆分提供了清晰的边界依据

> 来源：基于《事件风暴（Event Storming）实战指南：从混沌到澄清》技术博客文章整理，原文地址：https://mingyu.lighting/posts/ddd-event-storming-guide

---

## 📈 价值度量与效果评估

### 量化指标体系

| 指标类别 | 具体指标 | 目标值 | 测量方法 |
|---------|----------|--------|----------|
| 开发效率 | 功能交付周期 | 缩短30-50% | 对比实施前后的功能开发时间 |
| 系统质量 | 线上缺陷密度 | 降低40% | 统计每千行代码的缺陷数量 |
| 维护成本 | 系统维护工作量 | 减少40-60% | 统计维护工作人时 |
| 响应速度 | 业务需求响应时间 | 缩短50% | 测量从需求提出到上线的时间 |
| 团队满意度 | 团队协作效率 | 提升100% | 定期进行团队满意度调研 |
| 业务价值 | 客户满意度 | 提升20%+ | 客户满意度调研（NPS） |

### 效果评估时间点

- **短期评估（3个月）**：团队协作效率、开发流程改善
- **中期评估（6个月）**：系统质量提升、维护成本降低
- **长期评估（12个月）**：业务价值实现、投资回报达成

---

## 🔗 相关资源与参考文献

### 内部文档
- [《DDD工作流程说明文档》](DDD工作流程说明文档.md)
- [《商业模式到DDD战略规划工作标准指南》](软件工程规范/商业模式到DDD战略规划工作标准指南.md)
- [《工作岗位标准》](软件工程规范/00_文档标准/工作岗位标准.md)

### 外部参考
- 《领域驱动设计》- Eric Evans
- 《实现领域驱动设计》- Vaughn Vernon
- 《领域驱动设计模式、原理与实践》- Scott Millett

---

## 📞 联系方式

如有疑问或需要支持，请联系：
- **文档维护人**：伍志勇
- **更新时间**：2025年9月22日
- **下次评审**：2025年12月23日

---

**版权声明**：本文档版权归项目团队所有，仅供内部使用，禁止外传。